<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Zadrga</title>
	<style>
		body{
			margin: 0;
			overflow: hidden;
			background: #f7b731;
		}
	</style>
</head>
<body>
	<canvas id="zadrga"></canvas>
	<script type="text/javascript">
		let c = document.getElementById("zadrga");
		let ctx = c.getContext("2d");

		let size = 50;
		let position = 500;
		let w, h;

		function resize(){
			w = c.width = window.innerWidth;
			h = c.height = window.innerHeight;
			size = Math.min(w,h)/20;
			render();
		}

		function render(){
			//position = 1400;
			ctx.clearRect(0,0,w,h);

			// pobarvaj ozadje
			ctx.fillStyle = "#2bcbba"
			ctx.beginPath();
			let margin = Math.sqrt(4*(size*size)/8);
			ctx.arc(0, position, w/2-margin, Math.PI, 2*Math.PI);
			ctx.fill();
			ctx.beginPath();
			ctx.arc(w, position, w/2-margin, Math.PI, 2*Math.PI);
			ctx.fill();
			ctx.fillRect(0,position, w, h-position);

			let n;

			ctx.lineWidth = size/2;
			ctx.lineCap = "round";
			// narisi toothcke zadrge na ravnem delu
			n = Math.ceil((h-position)/size);
			for(let i=0; i<n; i++){
				// leva stran
				tooth(w/2, h - size*i, Math.PI/2);

				//desna stran
				tooth(w/2, h - size*(i+.5), -Math.PI/2);
			}

			// narisi toothcke zadrge na kroznem delu
			let clx = 0;
			let cly = position;
			let crx = w;
			let cry = position;
			let r = w/2;
			let offeset = n*size - (h-position);
			let angleOffset = offeset/r;
			n = (Math.PI*r)/size;
			for(let i=0; i<n; i++){
				//leva stran
				let angle = Math.PI/2+(Math.PI/n)*i + angleOffset;
				let sin = Math.sin(angle);
				let cos = Math.cos(angle);
				tooth(sin*(r)+clx, cos*(r)+cly, angle);

				//desna stran
				angle = Math.PI/2+(Math.PI/n)*(i+.5) + angleOffset;
				sin = Math.sin(-angle);
				cos = Math.cos(-angle);
				tooth(sin*(r)+crx, cos*(r)+cry, -angle);
			}
		}

		function tooth(x, y, angle){
			let r = Math.sqrt((size*size)/8);
			ctx.save();
			ctx.translate(x,y);
			ctx.rotate(-angle+Math.PI);
			ctx.fillStyle = "#eee";
			ctx.shadowOffsetX = 0;
			ctx.shadowOffsetY = 0;
			ctx.shadowBlur = 15;
			ctx.shadowColor = 'rgba(30,30,30,0.2)';

			ctx.beginPath();
			let sqrt = Math.sqrt(2*r*r);
			ctx.moveTo(-sqrt, sqrt+2*r - sqrt/2);
			ctx.arc(-sqrt, sqrt - sqrt/2, r, Math.PI/2, -Math.PI/4, true)
			ctx.arc(0, 0 - sqrt/2, r, Math.PI-Math.PI/4, Math.PI*2+Math.PI/4); // binkica na koncu
			ctx.arc(sqrt, sqrt - sqrt/2, r, Math.PI+Math.PI/4, Math.PI/2, true)
			ctx.lineTo(sqrt, sqrt+2*r - sqrt/2);
			ctx.closePath();
			ctx.fill();
			ctx.restore();
		}

		function mousemove(e){
			position = e.clientY;
			render();
		}

		resize();
		window.onmousemove = mousemove;
		window.onresize = resize;
	</script>
</body>
</html>
